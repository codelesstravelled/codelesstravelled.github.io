<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Solving Einstein riddle with Z3 - The code less travelled</title>
<meta name="description" content="Einstein’s five-houses consists, as the title says, of 5 houses. Each house has a certain color. Inside of each house, its owner has a pet, smokes a certain brand of cigars, drinks a certain beverage, and has a nationality. Any of these is unique between the house owners.  For a more detailed explanation, here is one from the University of Delaware.  Hints  The riddle gives the following hints:     the Brit lives in the red house   the Swede keeps dogs as pets   the Dane drinks tea   the green house is on the left of the white house   the green house’s owner drinks coffee   the person who smokes Pall Mall rears birds   the owner of the yellow house smokes Dunhill   the man living in the center house drinks milk   the Norwegian lives in the first house   the man who smokes blends lives next to the one who keeps cats   the man who keeps horses lives next to the man who smokes Dunhill   the owner who smokes BlueMaster drinks beer   the German smokes Prince   the Norwegian lives next to the blue house   the man who smokes blend has a neighbor who drinks water   Question  Given these hints, you have to answer the question Who owns the fish?  Solving it with Python Z3  To solve this problem I decided to try Microsoft’s Z3 Theorem Prover. It can be used in different programming languages such as C, C++, Java, Julia, Python among others. I decided to go with the Python interface.  Z3 can be used to solve Satisfiability Modulo Theories (SMT) problems. In simple terms, these problems involve several variables and logical relationships between them. The solver will try to find, if possible, a set of values for the variables that satisfy the relationships.  Implementation    For simplicity, I have assigned each house with a letter: A, B, C, D, E. Then, I created five 5x5 matrices. Each matrix corresponds to a category: Color, Nationality, Drink, Cigar, Pet. Inside each matrix, the rows correspond to the different values the category could take. For example, in the Color matrix, the rows correspond to Red, Blue, Green, Yellow, White. The columns identify each house: A, B, C, D, E.    Inside the cell of each matrix, I have assigned a Z3 Boolean value. It will be true or 1 if, for the corresponding category, the house has a certain value. For example, if house A is of color red, in the Color matrix the cell corresponding to column A and  row red will contain a true or 1. Logically, the rest of the values will contain false or 0    An important property is that each row or column can only contain a 1 or true value. It isn’t possible that, for example, both the A and C houses share a color. It is also impossible that a house has two different colors.  This is an important property and it will be a logical restraint of our Z3 model.  Let’s see how I implemented it in Python.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from z3 import *  houses = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;] names = {&quot;Color&quot;: [&quot;Red&quot;, &quot;Blue&quot;, &quot;Green&quot;, &quot;Yellow&quot;, &quot;White&quot;],         &quot;Nationality&quot;: [&quot;Brit&quot;, &quot;Swede&quot;, &quot;Dane&quot;, &quot;Norwegian&quot;, &quot;German&quot;],         &quot;Drink&quot;: [&quot;Coffee&quot;, &quot;Milk&quot;, &quot;Beer&quot;, &quot;Water&quot;, &quot;Tea&quot;],         &quot;Cigar&quot;: [&quot;PallMall&quot;, &quot;Dunhill&quot;, &quot;Prince&quot;, &quot;BlueMaster&quot;, &quot;Blends&quot;],         &quot;Pet&quot;: [&quot;Dog&quot;, &quot;Bird&quot;, &quot;Cat&quot;, &quot;Fish&quot;, &quot;Horse&quot;]}  matrices = {}  def add_names_constraints(solver, names):     for (name, values) in names.items():         amount_items = len(values)         matrix = [[0 for x in range(amount_items)] for y in range(amount_items)]         for i in range(amount_items):             for j in range(amount_items):                 matrix[i][j] = Bool(&quot;{}_{}&quot;.format(houses[j], values[i]))          for i in range(amount_items):             solver.add(Sum([If(item, 1, 0) for item in matrix[i]]) == 1)             solver.add(Sum([If(row[i], 1, 0) for row in matrix]) == 1)          matrices[name] = matrix   First I defined the houses’ names and all of the categories and their possible values.  Then, I created the function add_names_constraints that has two purposes:    To create the five matrices and populate them with Booleans values (lines 17 to 20).   To create the Z3 model constraints corresponding to each matrix row and column (lines 22 to 24).   Basic relationships  Now, let’s continue establishing model relationships. The riddle gives us a lot of basic relationships. These take two different values from different categories and assign them to a certain person or house. The basic relationships are:     the Brit lives in the red house   the Swede keeps dogs as pets   the Dane drinks tea   the green house’s owner drinks coffee   the person who smokes Pall Mall rears birds   the owner of the yellow house smokes Dunhill   the owner who smokes BlueMaster drinks beer   the German smokes Prince   Here is the function that will be used to create these relationships.  1 2 3 4 5 6 7 8 9 def add_relation(solver, first_category, first_value,                 second_category, second_value):     index1 = names[first_category].index(first_value)     index2 = names[second_category].index(second_value)      row1 = matrices[first_category][index1]     row2 = matrices[second_category][index2]      solver.add(Or([And(row1[i], row2[i]) for i in range(len(row1))]))   First, it transforms the text category and values into their corresponding indexes. Then it makes that the two rows have at least a coincidence in their corresponding house.  For example, the first relationship says: the Brit lives in the red house. That means that the Brit row in the nationalities matrix must be equal to the red row in the colors matrix.  As the code shows this relationship could be easily achieved with an And and an Or clauses.    House constraints  Next, we have the house constraints. These are simple to add to the model. The two house constraints that we have are:     the man living in the center house drinks milk   the Norwegian lives in the first house   1 2 3 4 5 6 7 def add_house_constraint(solver, house, category, value):     index1 = names[category].index(value)     index2 = houses.index(house)      item = matrices[category][index1][index2]      solver.add(item == True)   We simple force the corresponding cell to be true.  Neighbor constraints  Finally, we have the neighbor constraints. These come in the form of X lives next to Y. The riddle lists the following ones:     the Norwegian lives next to the blue house   the man who smokes blends lives next to the one who keeps cats   the man who keeps horses lives next to the man who smokes Dunhill   the man who smokes blend has a neighbor who drinks water   the green house is on the left of the white house   This is the function that i came up with:  1 2 3 4 5 6 7 8 9 10 11 12 13 def add_neighbor_constraint(solver, first_category, first_value,                          second_category, second_value, left_only=False):     index1 = names[first_category].index(first_value)     index2 = names[second_category].index(second_value)      row1 = matrices[first_category][index1]     row2 = matrices[second_category][index2]      conditions_list = [And(row1[i - 1], row2[i]) for i in range(1, len(row1))]     if not left_only:         conditions_list += [And(row2[i - 1], row1[i]) for i in range(1, len(row1))]      solver.add(Or(conditions_list))   This function is the most complex, but its logic is very similar to the basic relationships. The only difference is that we keep a shift of \(\pm\)1 between the rows’ indexes.  We have a left_only clause that is by default False. For the last constraint the green house is on the left of the white house we put this value as True.  Final steps and result  We finished with all the logic of the model, we only need to call the functions to build the model.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 s = Solver()  add_names_constraints(s, names)  add_relation(s, &quot;Nationality&quot;, &quot;Brit&quot;, &quot;Color&quot;, &quot;Red&quot;) add_relation(s, &quot;Nationality&quot;, &quot;Swede&quot;, &quot;Pet&quot;, &quot;Dog&quot;) add_relation(s, &quot;Nationality&quot;, &quot;Dane&quot;, &quot;Drink&quot;, &quot;Tea&quot;) add_relation(s, &quot;Color&quot;, &quot;Green&quot;, &quot;Drink&quot;, &quot;Coffee&quot;) add_relation(s, &quot;Cigar&quot;, &quot;PallMall&quot;, &quot;Pet&quot;, &quot;Bird&quot;) add_relation(s, &quot;Color&quot;, &quot;Yellow&quot;, &quot;Cigar&quot;, &quot;Dunhill&quot;) add_relation(s, &quot;Cigar&quot;, &quot;BlueMaster&quot;, &quot;Drink&quot;, &quot;Beer&quot;) add_relation(s, &quot;Nationality&quot;, &quot;German&quot;, &quot;Cigar&quot;, &quot;Prince&quot;)  add_house_constraint(s, &quot;C&quot;, &quot;Drink&quot;, &quot;Milk&quot;) add_house_constraint(s, &quot;A&quot;, &quot;Nationality&quot;, &quot;Norwegian&quot;)  add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Blends&quot;, &quot;Pet&quot;, &quot;Cat&quot;) add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Dunhill&quot;, &quot;Pet&quot;, &quot;Horse&quot;) add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Blends&quot;, &quot;Drink&quot;, &quot;Water&quot;) add_neighbor_constraint(s, &quot;Nationality&quot;, &quot;Norwegian&quot;, &quot;Color&quot;, &quot;Blue&quot;)  add_neighbor_constraint(s, &quot;Color&quot;, &quot;Green&quot;, &quot;Color&quot;, &quot;White&quot;, left_only=True)  print (s.check()) print (s.model())  m = s.model() true_statements = []  for x in m:     if is_true(m[x]):         true_statements.append(x.name())  result = {}  for house in houses:     result[house] = [true_statements[i][2:] for i in range(len(true_statements))                     if true_statements[i][0] == house]  print(result)   We added some prints to see the viability of the model and the model itself. In the end, we added some logic to parse the results. We would only like to see which values in the matrices contain a true value.  After running the program it shows us:  {&#39;A&#39;: [&#39;Dunhill&#39;, &#39;Cat&#39;, &#39;Yellow&#39;, &#39;Water&#39;, &#39;Norwegian&#39;], &#39;B&#39;: [&#39;Blue&#39;, &#39;Dane&#39;, &#39;Blends&#39;, &#39;Tea&#39;, &#39;Horse&#39;], &#39;C&#39;: [&#39;Bird&#39;, &#39;Brit&#39;, &#39;Red&#39;, &#39;PallMall&#39;, &#39;Milk&#39;], &#39;D&#39;: [&#39;Prince&#39;, &#39;German&#39;, &#39;Fish&#39;, &#39;Green&#39;, &#39;Coffee&#39;], &#39;E&#39;: [&#39;Dog&#39;, &#39;Beer&#39;, &#39;Swede&#39;, &#39;White&#39;, &#39;BlueMaster&#39;]}  We could see that the German is the owner of the fish.  Looking at the solution, we verify that our model worked correctly.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="The code less travelled">
<meta property="og:title" content="Solving Einstein riddle with Z3">
<meta property="og:url" content="http://localhost:4000/python/z3/riddle/2021/12/04/solving-Einstein-riddle-with-Z3.html">


  <meta property="og:description" content="Einstein’s five-houses consists, as the title says, of 5 houses. Each house has a certain color. Inside of each house, its owner has a pet, smokes a certain brand of cigars, drinks a certain beverage, and has a nationality. Any of these is unique between the house owners.  For a more detailed explanation, here is one from the University of Delaware.  Hints  The riddle gives the following hints:     the Brit lives in the red house   the Swede keeps dogs as pets   the Dane drinks tea   the green house is on the left of the white house   the green house’s owner drinks coffee   the person who smokes Pall Mall rears birds   the owner of the yellow house smokes Dunhill   the man living in the center house drinks milk   the Norwegian lives in the first house   the man who smokes blends lives next to the one who keeps cats   the man who keeps horses lives next to the man who smokes Dunhill   the owner who smokes BlueMaster drinks beer   the German smokes Prince   the Norwegian lives next to the blue house   the man who smokes blend has a neighbor who drinks water   Question  Given these hints, you have to answer the question Who owns the fish?  Solving it with Python Z3  To solve this problem I decided to try Microsoft’s Z3 Theorem Prover. It can be used in different programming languages such as C, C++, Java, Julia, Python among others. I decided to go with the Python interface.  Z3 can be used to solve Satisfiability Modulo Theories (SMT) problems. In simple terms, these problems involve several variables and logical relationships between them. The solver will try to find, if possible, a set of values for the variables that satisfy the relationships.  Implementation    For simplicity, I have assigned each house with a letter: A, B, C, D, E. Then, I created five 5x5 matrices. Each matrix corresponds to a category: Color, Nationality, Drink, Cigar, Pet. Inside each matrix, the rows correspond to the different values the category could take. For example, in the Color matrix, the rows correspond to Red, Blue, Green, Yellow, White. The columns identify each house: A, B, C, D, E.    Inside the cell of each matrix, I have assigned a Z3 Boolean value. It will be true or 1 if, for the corresponding category, the house has a certain value. For example, if house A is of color red, in the Color matrix the cell corresponding to column A and  row red will contain a true or 1. Logically, the rest of the values will contain false or 0    An important property is that each row or column can only contain a 1 or true value. It isn’t possible that, for example, both the A and C houses share a color. It is also impossible that a house has two different colors.  This is an important property and it will be a logical restraint of our Z3 model.  Let’s see how I implemented it in Python.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from z3 import *  houses = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;] names = {&quot;Color&quot;: [&quot;Red&quot;, &quot;Blue&quot;, &quot;Green&quot;, &quot;Yellow&quot;, &quot;White&quot;],         &quot;Nationality&quot;: [&quot;Brit&quot;, &quot;Swede&quot;, &quot;Dane&quot;, &quot;Norwegian&quot;, &quot;German&quot;],         &quot;Drink&quot;: [&quot;Coffee&quot;, &quot;Milk&quot;, &quot;Beer&quot;, &quot;Water&quot;, &quot;Tea&quot;],         &quot;Cigar&quot;: [&quot;PallMall&quot;, &quot;Dunhill&quot;, &quot;Prince&quot;, &quot;BlueMaster&quot;, &quot;Blends&quot;],         &quot;Pet&quot;: [&quot;Dog&quot;, &quot;Bird&quot;, &quot;Cat&quot;, &quot;Fish&quot;, &quot;Horse&quot;]}  matrices = {}  def add_names_constraints(solver, names):     for (name, values) in names.items():         amount_items = len(values)         matrix = [[0 for x in range(amount_items)] for y in range(amount_items)]         for i in range(amount_items):             for j in range(amount_items):                 matrix[i][j] = Bool(&quot;{}_{}&quot;.format(houses[j], values[i]))          for i in range(amount_items):             solver.add(Sum([If(item, 1, 0) for item in matrix[i]]) == 1)             solver.add(Sum([If(row[i], 1, 0) for row in matrix]) == 1)          matrices[name] = matrix   First I defined the houses’ names and all of the categories and their possible values.  Then, I created the function add_names_constraints that has two purposes:    To create the five matrices and populate them with Booleans values (lines 17 to 20).   To create the Z3 model constraints corresponding to each matrix row and column (lines 22 to 24).   Basic relationships  Now, let’s continue establishing model relationships. The riddle gives us a lot of basic relationships. These take two different values from different categories and assign them to a certain person or house. The basic relationships are:     the Brit lives in the red house   the Swede keeps dogs as pets   the Dane drinks tea   the green house’s owner drinks coffee   the person who smokes Pall Mall rears birds   the owner of the yellow house smokes Dunhill   the owner who smokes BlueMaster drinks beer   the German smokes Prince   Here is the function that will be used to create these relationships.  1 2 3 4 5 6 7 8 9 def add_relation(solver, first_category, first_value,                 second_category, second_value):     index1 = names[first_category].index(first_value)     index2 = names[second_category].index(second_value)      row1 = matrices[first_category][index1]     row2 = matrices[second_category][index2]      solver.add(Or([And(row1[i], row2[i]) for i in range(len(row1))]))   First, it transforms the text category and values into their corresponding indexes. Then it makes that the two rows have at least a coincidence in their corresponding house.  For example, the first relationship says: the Brit lives in the red house. That means that the Brit row in the nationalities matrix must be equal to the red row in the colors matrix.  As the code shows this relationship could be easily achieved with an And and an Or clauses.    House constraints  Next, we have the house constraints. These are simple to add to the model. The two house constraints that we have are:     the man living in the center house drinks milk   the Norwegian lives in the first house   1 2 3 4 5 6 7 def add_house_constraint(solver, house, category, value):     index1 = names[category].index(value)     index2 = houses.index(house)      item = matrices[category][index1][index2]      solver.add(item == True)   We simple force the corresponding cell to be true.  Neighbor constraints  Finally, we have the neighbor constraints. These come in the form of X lives next to Y. The riddle lists the following ones:     the Norwegian lives next to the blue house   the man who smokes blends lives next to the one who keeps cats   the man who keeps horses lives next to the man who smokes Dunhill   the man who smokes blend has a neighbor who drinks water   the green house is on the left of the white house   This is the function that i came up with:  1 2 3 4 5 6 7 8 9 10 11 12 13 def add_neighbor_constraint(solver, first_category, first_value,                          second_category, second_value, left_only=False):     index1 = names[first_category].index(first_value)     index2 = names[second_category].index(second_value)      row1 = matrices[first_category][index1]     row2 = matrices[second_category][index2]      conditions_list = [And(row1[i - 1], row2[i]) for i in range(1, len(row1))]     if not left_only:         conditions_list += [And(row2[i - 1], row1[i]) for i in range(1, len(row1))]      solver.add(Or(conditions_list))   This function is the most complex, but its logic is very similar to the basic relationships. The only difference is that we keep a shift of \(\pm\)1 between the rows’ indexes.  We have a left_only clause that is by default False. For the last constraint the green house is on the left of the white house we put this value as True.  Final steps and result  We finished with all the logic of the model, we only need to call the functions to build the model.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 s = Solver()  add_names_constraints(s, names)  add_relation(s, &quot;Nationality&quot;, &quot;Brit&quot;, &quot;Color&quot;, &quot;Red&quot;) add_relation(s, &quot;Nationality&quot;, &quot;Swede&quot;, &quot;Pet&quot;, &quot;Dog&quot;) add_relation(s, &quot;Nationality&quot;, &quot;Dane&quot;, &quot;Drink&quot;, &quot;Tea&quot;) add_relation(s, &quot;Color&quot;, &quot;Green&quot;, &quot;Drink&quot;, &quot;Coffee&quot;) add_relation(s, &quot;Cigar&quot;, &quot;PallMall&quot;, &quot;Pet&quot;, &quot;Bird&quot;) add_relation(s, &quot;Color&quot;, &quot;Yellow&quot;, &quot;Cigar&quot;, &quot;Dunhill&quot;) add_relation(s, &quot;Cigar&quot;, &quot;BlueMaster&quot;, &quot;Drink&quot;, &quot;Beer&quot;) add_relation(s, &quot;Nationality&quot;, &quot;German&quot;, &quot;Cigar&quot;, &quot;Prince&quot;)  add_house_constraint(s, &quot;C&quot;, &quot;Drink&quot;, &quot;Milk&quot;) add_house_constraint(s, &quot;A&quot;, &quot;Nationality&quot;, &quot;Norwegian&quot;)  add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Blends&quot;, &quot;Pet&quot;, &quot;Cat&quot;) add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Dunhill&quot;, &quot;Pet&quot;, &quot;Horse&quot;) add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Blends&quot;, &quot;Drink&quot;, &quot;Water&quot;) add_neighbor_constraint(s, &quot;Nationality&quot;, &quot;Norwegian&quot;, &quot;Color&quot;, &quot;Blue&quot;)  add_neighbor_constraint(s, &quot;Color&quot;, &quot;Green&quot;, &quot;Color&quot;, &quot;White&quot;, left_only=True)  print (s.check()) print (s.model())  m = s.model() true_statements = []  for x in m:     if is_true(m[x]):         true_statements.append(x.name())  result = {}  for house in houses:     result[house] = [true_statements[i][2:] for i in range(len(true_statements))                     if true_statements[i][0] == house]  print(result)   We added some prints to see the viability of the model and the model itself. In the end, we added some logic to parse the results. We would only like to see which values in the matrices contain a true value.  After running the program it shows us:  {&#39;A&#39;: [&#39;Dunhill&#39;, &#39;Cat&#39;, &#39;Yellow&#39;, &#39;Water&#39;, &#39;Norwegian&#39;], &#39;B&#39;: [&#39;Blue&#39;, &#39;Dane&#39;, &#39;Blends&#39;, &#39;Tea&#39;, &#39;Horse&#39;], &#39;C&#39;: [&#39;Bird&#39;, &#39;Brit&#39;, &#39;Red&#39;, &#39;PallMall&#39;, &#39;Milk&#39;], &#39;D&#39;: [&#39;Prince&#39;, &#39;German&#39;, &#39;Fish&#39;, &#39;Green&#39;, &#39;Coffee&#39;], &#39;E&#39;: [&#39;Dog&#39;, &#39;Beer&#39;, &#39;Swede&#39;, &#39;White&#39;, &#39;BlueMaster&#39;]}  We could see that the German is the owner of the fish.  Looking at the solution, we verify that our model worked correctly.">



  <meta property="og:image" content="http://localhost:4000/assets/images/post2header.png">





  <meta property="article:published_time" content="2021-12-04T14:00:00-03:00">






<link rel="canonical" href="http://localhost:4000/python/z3/riddle/2021/12/04/solving-Einstein-riddle-with-Z3.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="The code less travelled Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <link rel="stylesheet" href="/assets/css/mycss.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&display=swap" rel="stylesheet">
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          The code less travelled
          
        </a>
        
        <object id="road-img" type="image/svg+xml" data="/assets/svg/ruta.svg"></object>
        
        <ul class="visible-links"></ul>
        
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Solving Einstein riddle with Z3">
    <meta itemprop="description" content="Einstein’s five-houses consists, as the title says, of 5 houses. Each house has a certain color. Inside of each house, its owner has a pet, smokes a certain brand of cigars, drinks a certain beverage, and has a nationality. Any of these is unique between the house owners.For a more detailed explanation, here is one from the University of Delaware.HintsThe riddle gives the following hints:  the Brit lives in the red house  the Swede keeps dogs as pets  the Dane drinks tea  the green house is on the left of the white house  the green house’s owner drinks coffee  the person who smokes Pall Mall rears birds  the owner of the yellow house smokes Dunhill  the man living in the center house drinks milk  the Norwegian lives in the first house  the man who smokes blends lives next to the one who keeps cats  the man who keeps horses lives next to the man who smokes Dunhill  the owner who smokes BlueMaster drinks beer  the German smokes Prince  the Norwegian lives next to the blue house  the man who smokes blend has a neighbor who drinks waterQuestionGiven these hints, you have to answer the question Who owns the fish?Solving it with Python Z3To solve this problem I decided to try Microsoft’s Z3 Theorem Prover. It can be used in different programming languages such as C, C++, Java, Julia, Python among others. I decided to go with the Python interface.Z3 can be used to solve Satisfiability Modulo Theories (SMT) problems. In simple terms, these problems involve several variables and logical relationships between them. The solver will try to find, if possible, a set of values for the variables that satisfy the relationships.ImplementationFor simplicity, I have assigned each house with a letter: A, B, C, D, E. Then, I created five 5x5 matrices. Each matrix corresponds to a category: Color, Nationality, Drink, Cigar, Pet. Inside each matrix, the rows correspond to the different values the category could take. For example, in the Color matrix, the rows correspond to Red, Blue, Green, Yellow, White. The columns identify each house: A, B, C, D, E.Inside the cell of each matrix, I have assigned a Z3 Boolean value. It will be true or 1 if, for the corresponding category, the house has a certain value. For example, if house A is of color red, in the Color matrix the cell corresponding to column A and  row red will contain a true or 1. Logically, the rest of the values will contain false or 0An important property is that each row or column can only contain a 1 or true value. It isn’t possible that, for example, both the A and C houses share a color. It is also impossible that a house has two different colors.This is an important property and it will be a logical restraint of our Z3 model.Let’s see how I implemented it in Python.123456789101112131415161718192021222324from z3 import *houses = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;]names = {&quot;Color&quot;: [&quot;Red&quot;, &quot;Blue&quot;, &quot;Green&quot;, &quot;Yellow&quot;, &quot;White&quot;],        &quot;Nationality&quot;: [&quot;Brit&quot;, &quot;Swede&quot;, &quot;Dane&quot;, &quot;Norwegian&quot;, &quot;German&quot;],        &quot;Drink&quot;: [&quot;Coffee&quot;, &quot;Milk&quot;, &quot;Beer&quot;, &quot;Water&quot;, &quot;Tea&quot;],        &quot;Cigar&quot;: [&quot;PallMall&quot;, &quot;Dunhill&quot;, &quot;Prince&quot;, &quot;BlueMaster&quot;, &quot;Blends&quot;],        &quot;Pet&quot;: [&quot;Dog&quot;, &quot;Bird&quot;, &quot;Cat&quot;, &quot;Fish&quot;, &quot;Horse&quot;]}matrices = {}def add_names_constraints(solver, names):    for (name, values) in names.items():        amount_items = len(values)        matrix = [[0 for x in range(amount_items)] for y in range(amount_items)]        for i in range(amount_items):            for j in range(amount_items):                matrix[i][j] = Bool(&quot;{}_{}&quot;.format(houses[j], values[i]))        for i in range(amount_items):            solver.add(Sum([If(item, 1, 0) for item in matrix[i]]) == 1)            solver.add(Sum([If(row[i], 1, 0) for row in matrix]) == 1)        matrices[name] = matrixFirst I defined the houses’ names and all of the categories and their possible values.Then, I created the function add_names_constraints that has two purposes:  To create the five matrices and populate them with Booleans values (lines 17 to 20).  To create the Z3 model constraints corresponding to each matrix row and column (lines 22 to 24).Basic relationshipsNow, let’s continue establishing model relationships. The riddle gives us a lot of basic relationships. These take two different values from different categories and assign them to a certain person or house. The basic relationships are:  the Brit lives in the red house  the Swede keeps dogs as pets  the Dane drinks tea  the green house’s owner drinks coffee  the person who smokes Pall Mall rears birds  the owner of the yellow house smokes Dunhill  the owner who smokes BlueMaster drinks beer  the German smokes PrinceHere is the function that will be used to create these relationships.123456789def add_relation(solver, first_category, first_value,                second_category, second_value):    index1 = names[first_category].index(first_value)    index2 = names[second_category].index(second_value)    row1 = matrices[first_category][index1]    row2 = matrices[second_category][index2]    solver.add(Or([And(row1[i], row2[i]) for i in range(len(row1))]))First, it transforms the text category and values into their corresponding indexes. Then it makes that the two rows have at least a coincidence in their corresponding house.For example, the first relationship says: the Brit lives in the red house. That means that the Brit row in the nationalities matrix must be equal to the red row in the colors matrix.As the code shows this relationship could be easily achieved with an And and an Or clauses.House constraintsNext, we have the house constraints. These are simple to add to the model. The two house constraints that we have are:  the man living in the center house drinks milk  the Norwegian lives in the first house1234567def add_house_constraint(solver, house, category, value):    index1 = names[category].index(value)    index2 = houses.index(house)    item = matrices[category][index1][index2]    solver.add(item == True)We simple force the corresponding cell to be true.Neighbor constraintsFinally, we have the neighbor constraints. These come in the form of X lives next to Y. The riddle lists the following ones:  the Norwegian lives next to the blue house  the man who smokes blends lives next to the one who keeps cats  the man who keeps horses lives next to the man who smokes Dunhill  the man who smokes blend has a neighbor who drinks water  the green house is on the left of the white houseThis is the function that i came up with:12345678910111213def add_neighbor_constraint(solver, first_category, first_value,                         second_category, second_value, left_only=False):    index1 = names[first_category].index(first_value)    index2 = names[second_category].index(second_value)    row1 = matrices[first_category][index1]    row2 = matrices[second_category][index2]    conditions_list = [And(row1[i - 1], row2[i]) for i in range(1, len(row1))]    if not left_only:        conditions_list += [And(row2[i - 1], row1[i]) for i in range(1, len(row1))]    solver.add(Or(conditions_list))This function is the most complex, but its logic is very similar to the basic relationships. The only difference is that we keep a shift of \(\pm\)1 between the rows’ indexes.We have a left_only clause that is by default False. For the last constraint the green house is on the left of the white house we put this value as True.Final steps and resultWe finished with all the logic of the model, we only need to call the functions to build the model.12345678910111213141516171819202122232425262728293031323334353637383940s = Solver()add_names_constraints(s, names)add_relation(s, &quot;Nationality&quot;, &quot;Brit&quot;, &quot;Color&quot;, &quot;Red&quot;)add_relation(s, &quot;Nationality&quot;, &quot;Swede&quot;, &quot;Pet&quot;, &quot;Dog&quot;)add_relation(s, &quot;Nationality&quot;, &quot;Dane&quot;, &quot;Drink&quot;, &quot;Tea&quot;)add_relation(s, &quot;Color&quot;, &quot;Green&quot;, &quot;Drink&quot;, &quot;Coffee&quot;)add_relation(s, &quot;Cigar&quot;, &quot;PallMall&quot;, &quot;Pet&quot;, &quot;Bird&quot;)add_relation(s, &quot;Color&quot;, &quot;Yellow&quot;, &quot;Cigar&quot;, &quot;Dunhill&quot;)add_relation(s, &quot;Cigar&quot;, &quot;BlueMaster&quot;, &quot;Drink&quot;, &quot;Beer&quot;)add_relation(s, &quot;Nationality&quot;, &quot;German&quot;, &quot;Cigar&quot;, &quot;Prince&quot;)add_house_constraint(s, &quot;C&quot;, &quot;Drink&quot;, &quot;Milk&quot;)add_house_constraint(s, &quot;A&quot;, &quot;Nationality&quot;, &quot;Norwegian&quot;)add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Blends&quot;, &quot;Pet&quot;, &quot;Cat&quot;)add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Dunhill&quot;, &quot;Pet&quot;, &quot;Horse&quot;)add_neighbor_constraint(s, &quot;Cigar&quot;, &quot;Blends&quot;, &quot;Drink&quot;, &quot;Water&quot;)add_neighbor_constraint(s, &quot;Nationality&quot;, &quot;Norwegian&quot;, &quot;Color&quot;, &quot;Blue&quot;)add_neighbor_constraint(s, &quot;Color&quot;, &quot;Green&quot;, &quot;Color&quot;, &quot;White&quot;, left_only=True)print (s.check())print (s.model())m = s.model()true_statements = []for x in m:    if is_true(m[x]):        true_statements.append(x.name())result = {}for house in houses:    result[house] = [true_statements[i][2:] for i in range(len(true_statements))                    if true_statements[i][0] == house]print(result)We added some prints to see the viability of the model and the model itself. In the end, we added some logic to parse the results. We would only like to see which values in the matrices contain a true value.After running the program it shows us:{&#39;A&#39;: [&#39;Dunhill&#39;, &#39;Cat&#39;, &#39;Yellow&#39;, &#39;Water&#39;, &#39;Norwegian&#39;],&#39;B&#39;: [&#39;Blue&#39;, &#39;Dane&#39;, &#39;Blends&#39;, &#39;Tea&#39;, &#39;Horse&#39;],&#39;C&#39;: [&#39;Bird&#39;, &#39;Brit&#39;, &#39;Red&#39;, &#39;PallMall&#39;, &#39;Milk&#39;],&#39;D&#39;: [&#39;Prince&#39;, &#39;German&#39;, &#39;Fish&#39;, &#39;Green&#39;, &#39;Coffee&#39;],&#39;E&#39;: [&#39;Dog&#39;, &#39;Beer&#39;, &#39;Swede&#39;, &#39;White&#39;, &#39;BlueMaster&#39;]}We could see that the German is the owner of the fish.Looking at the solution, we verify that our model worked correctly.">
    <meta itemprop="datePublished" content="2021-12-04T14:00:00-03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Solving Einstein riddle with Z3
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Einstein’s five-houses consists, as the title says, of 5 houses. Each house has a certain color. Inside of each house, its owner has a pet, smokes a certain brand of cigars, drinks a certain beverage, and has a nationality. Any of these is unique between the house owners.</p>

<p>For a more detailed explanation, <a href="https://udel.edu/~os/riddle.html">here</a> is one from the University of Delaware.</p>

<h1 id="hints">Hints</h1>

<p>The riddle gives the following hints:</p>

<ul>
  <li>the Brit lives in the red house</li>
  <li>the Swede keeps dogs as pets</li>
  <li>the Dane drinks tea</li>
  <li>the green house is on the left of the white house</li>
  <li>the green house’s owner drinks coffee</li>
  <li>the person who smokes Pall Mall rears birds</li>
  <li>the owner of the yellow house smokes Dunhill</li>
  <li>the man living in the center house drinks milk</li>
  <li>the Norwegian lives in the first house</li>
  <li>the man who smokes blends lives next to the one who keeps cats</li>
  <li>the man who keeps horses lives next to the man who smokes Dunhill</li>
  <li>the owner who smokes BlueMaster drinks beer</li>
  <li>the German smokes Prince</li>
  <li>the Norwegian lives next to the blue house</li>
  <li>the man who smokes blend has a neighbor who drinks water</li>
</ul>

<h1 id="question">Question</h1>

<p>Given these hints, you have to answer the question <strong>Who owns the fish?</strong></p>

<h1 id="solving-it-with-python-z3">Solving it with Python Z3</h1>

<p>To solve this problem I decided to try <a href="https://github.com/Z3Prover/z3">Microsoft’s Z3 Theorem Prover</a>. It can be used in different programming languages such as <code class="language-plaintext highlighter-rouge">C</code>, <code class="language-plaintext highlighter-rouge">C++</code>, <code class="language-plaintext highlighter-rouge">Java</code>, <code class="language-plaintext highlighter-rouge">Julia</code>, <code class="language-plaintext highlighter-rouge">Python</code> among others. I decided to go with the Python interface.</p>

<p>Z3 can be used to solve Satisfiability Modulo Theories (SMT) problems. In simple terms, these problems involve several variables and logical relationships between them. The solver will try to find, if possible, a set of values for the variables that satisfy the relationships.</p>

<h1 id="implementation">Implementation</h1>

<p><img src="/assets/images/houses.png" alt="Houses" /></p>

<p>For simplicity, I have assigned each house with a letter: <em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>, <em>E</em>. Then, I created five 5x5 matrices. Each matrix corresponds to a category: <em>Color</em>, <em>Nationality</em>, <em>Drink</em>, <em>Cigar</em>, <em>Pet</em>. Inside each matrix, the rows correspond to the different values the category could take. For example, in the <em>Color</em> matrix, the rows correspond to <em>Red</em>, <em>Blue</em>, <em>Green</em>, <em>Yellow</em>, <em>White</em>. The columns identify each house: <em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>, <em>E</em>.</p>

<p><img src="/assets/images/matrices.png" alt="Matrices" /></p>

<p>Inside the cell of each matrix, I have assigned a Z3 Boolean value. It will be <strong>true</strong> or <strong>1</strong> if, for the corresponding category, the house has a certain value. For example, if house <em>A</em> is of <em>color red</em>, in the <em>Color</em> matrix the cell corresponding to column <em>A</em> and  row <em>red</em> will contain a <strong>true</strong> or <strong>1</strong>. Logically, the rest of the values will contain <strong>false</strong> or <strong>0</strong></p>

<p><img src="/assets/images/matrix_colors.png" alt="Matrix of color" /></p>

<p>An important property is that each row or column can only contain a <strong>1</strong> or <strong>true</strong> value. It isn’t possible that, for example, both the <em>A</em> and <em>C</em> houses share a color. It is also impossible that a house has two different colors.</p>

<p>This is an important property and it will be a logical restraint of our Z3 model.</p>

<p>Let’s see how I implemented it in Python.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">z3</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">houses</span> <span class="o">=</span> <span class="p">[</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">,</span> <span class="s">"C"</span><span class="p">,</span> <span class="s">"D"</span><span class="p">,</span> <span class="s">"E"</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Color"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Red"</span><span class="p">,</span> <span class="s">"Blue"</span><span class="p">,</span> <span class="s">"Green"</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">,</span> <span class="s">"White"</span><span class="p">],</span>
        <span class="s">"Nationality"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Brit"</span><span class="p">,</span> <span class="s">"Swede"</span><span class="p">,</span> <span class="s">"Dane"</span><span class="p">,</span> <span class="s">"Norwegian"</span><span class="p">,</span> <span class="s">"German"</span><span class="p">],</span>
        <span class="s">"Drink"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Coffee"</span><span class="p">,</span> <span class="s">"Milk"</span><span class="p">,</span> <span class="s">"Beer"</span><span class="p">,</span> <span class="s">"Water"</span><span class="p">,</span> <span class="s">"Tea"</span><span class="p">],</span>
        <span class="s">"Cigar"</span><span class="p">:</span> <span class="p">[</span><span class="s">"PallMall"</span><span class="p">,</span> <span class="s">"Dunhill"</span><span class="p">,</span> <span class="s">"Prince"</span><span class="p">,</span> <span class="s">"BlueMaster"</span><span class="p">,</span> <span class="s">"Blends"</span><span class="p">],</span>
        <span class="s">"Pet"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Dog"</span><span class="p">,</span> <span class="s">"Bird"</span><span class="p">,</span> <span class="s">"Cat"</span><span class="p">,</span> <span class="s">"Fish"</span><span class="p">,</span> <span class="s">"Horse"</span><span class="p">]}</span>

<span class="n">matrices</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">add_names_constraints</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="ow">in</span> <span class="n">names</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">amount_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_items</span><span class="p">)]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_items</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_items</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_items</span><span class="p">):</span>
                <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="s">"{}_{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">houses</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">amount_items</span><span class="p">):</span>
            <span class="n">solver</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Sum</span><span class="p">([</span><span class="n">If</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">solver</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Sum</span><span class="p">([</span><span class="n">If</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">matrices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>First I defined the houses’ names and all of the categories and their possible values.</p>

<p>Then, I created the function <code class="language-plaintext highlighter-rouge">add_names_constraints</code> that has two purposes:</p>
<ul>
  <li>To create the five matrices and populate them with Booleans values (lines 17 to 20).</li>
  <li>To create the Z3 model constraints corresponding to each matrix row and column (lines 22 to 24).</li>
</ul>

<h2 id="basic-relationships">Basic relationships</h2>

<p>Now, let’s continue establishing model relationships. The riddle gives us a lot of <code class="language-plaintext highlighter-rouge">basic relationships</code>. These take two different values from different categories and assign them to a certain person or house. The <code class="language-plaintext highlighter-rouge">basic relationships</code> are:</p>

<ul>
  <li>the Brit lives in the red house</li>
  <li>the Swede keeps dogs as pets</li>
  <li>the Dane drinks tea</li>
  <li>the green house’s owner drinks coffee</li>
  <li>the person who smokes Pall Mall rears birds</li>
  <li>the owner of the yellow house smokes Dunhill</li>
  <li>the owner who smokes BlueMaster drinks beer</li>
  <li>the German smokes Prince</li>
</ul>

<p>Here is the function that will be used to create these relationships.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">add_relation</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">first_category</span><span class="p">,</span> <span class="n">first_value</span><span class="p">,</span>
                <span class="n">second_category</span><span class="p">,</span> <span class="n">second_value</span><span class="p">):</span>
    <span class="n">index1</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">first_category</span><span class="p">].</span><span class="n">index</span><span class="p">(</span><span class="n">first_value</span><span class="p">)</span>
    <span class="n">index2</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">second_category</span><span class="p">].</span><span class="n">index</span><span class="p">(</span><span class="n">second_value</span><span class="p">)</span>

    <span class="n">row1</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="n">first_category</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span>
    <span class="n">row2</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="n">second_category</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span>

    <span class="n">solver</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Or</span><span class="p">([</span><span class="n">And</span><span class="p">(</span><span class="n">row1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row1</span><span class="p">))]))</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>First, it transforms the text category and values into their corresponding indexes. Then it makes that the two rows have at least a coincidence in their corresponding house.</p>

<p>For example, the first relationship says: <em>the Brit lives in the red house</em>. That means that the Brit row in the nationalities matrix must be equal to the red row in the colors matrix.</p>

<p>As the code shows this relationship could be easily achieved with an <strong>And</strong> and an <strong>Or</strong> clauses.</p>

<p><img src="/assets/images/matrix_matching.png" alt="Matrix of color" /></p>

<h2 id="house-constraints">House constraints</h2>

<p>Next, we have the <code class="language-plaintext highlighter-rouge">house constraints</code>. These are simple to add to the model. The two <code class="language-plaintext highlighter-rouge">house constraints</code> that we have are:</p>

<ul>
  <li>the man living in the center house drinks milk</li>
  <li>the Norwegian lives in the first house</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">add_house_constraint</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">house</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">index1</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">category</span><span class="p">].</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">index2</span> <span class="o">=</span> <span class="n">houses</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">house</span><span class="p">)</span>

    <span class="n">item</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">index1</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span>

    <span class="n">solver</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>We simple force the corresponding cell to be <strong>true</strong>.</p>

<h2 id="neighbor-constraints">Neighbor constraints</h2>

<p>Finally, we have the <code class="language-plaintext highlighter-rouge">neighbor constraints</code>. These come in the form of <em>X</em> lives next to <em>Y</em>. The riddle lists the following ones:</p>

<ul>
  <li>the Norwegian lives next to the blue house</li>
  <li>the man who smokes blends lives next to the one who keeps cats</li>
  <li>the man who keeps horses lives next to the man who smokes Dunhill</li>
  <li>the man who smokes blend has a neighbor who drinks water</li>
  <li>the green house is on the left of the white house</li>
</ul>

<p>This is the function that i came up with:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">add_neighbor_constraint</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">first_category</span><span class="p">,</span> <span class="n">first_value</span><span class="p">,</span> 
                        <span class="n">second_category</span><span class="p">,</span> <span class="n">second_value</span><span class="p">,</span> <span class="n">left_only</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">index1</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">first_category</span><span class="p">].</span><span class="n">index</span><span class="p">(</span><span class="n">first_value</span><span class="p">)</span>
    <span class="n">index2</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">second_category</span><span class="p">].</span><span class="n">index</span><span class="p">(</span><span class="n">second_value</span><span class="p">)</span>

    <span class="n">row1</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="n">first_category</span><span class="p">][</span><span class="n">index1</span><span class="p">]</span>
    <span class="n">row2</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="n">second_category</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span>

    <span class="n">conditions_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">row1</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">row1</span><span class="p">))]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">left_only</span><span class="p">:</span>
        <span class="n">conditions_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">row2</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">row1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">row1</span><span class="p">))]</span>

    <span class="n">solver</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Or</span><span class="p">(</span><span class="n">conditions_list</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>This function is the most complex, but its logic is very similar to the <code class="language-plaintext highlighter-rouge">basic relationships</code>. The only difference is that we keep a shift of \(\pm\)1 between the rows’ indexes.</p>

<p>We have a <em>left_only</em> clause that is by default <strong>False</strong>. For the last constraint <em>the green house is on the left of the white house</em> we put this value as <em>True</em>.</p>

<h1 id="final-steps-and-result">Final steps and result</h1>

<p>We finished with all the logic of the model, we only need to call the functions to build the model.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="code"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">()</span>

<span class="n">add_names_constraints</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Nationality"</span><span class="p">,</span> <span class="s">"Brit"</span><span class="p">,</span> <span class="s">"Color"</span><span class="p">,</span> <span class="s">"Red"</span><span class="p">)</span>
<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Nationality"</span><span class="p">,</span> <span class="s">"Swede"</span><span class="p">,</span> <span class="s">"Pet"</span><span class="p">,</span> <span class="s">"Dog"</span><span class="p">)</span>
<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Nationality"</span><span class="p">,</span> <span class="s">"Dane"</span><span class="p">,</span> <span class="s">"Drink"</span><span class="p">,</span> <span class="s">"Tea"</span><span class="p">)</span>
<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Color"</span><span class="p">,</span> <span class="s">"Green"</span><span class="p">,</span> <span class="s">"Drink"</span><span class="p">,</span> <span class="s">"Coffee"</span><span class="p">)</span>
<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Cigar"</span><span class="p">,</span> <span class="s">"PallMall"</span><span class="p">,</span> <span class="s">"Pet"</span><span class="p">,</span> <span class="s">"Bird"</span><span class="p">)</span>
<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Color"</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">,</span> <span class="s">"Cigar"</span><span class="p">,</span> <span class="s">"Dunhill"</span><span class="p">)</span>
<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Cigar"</span><span class="p">,</span> <span class="s">"BlueMaster"</span><span class="p">,</span> <span class="s">"Drink"</span><span class="p">,</span> <span class="s">"Beer"</span><span class="p">)</span>
<span class="n">add_relation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Nationality"</span><span class="p">,</span> <span class="s">"German"</span><span class="p">,</span> <span class="s">"Cigar"</span><span class="p">,</span> <span class="s">"Prince"</span><span class="p">)</span>

<span class="n">add_house_constraint</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"C"</span><span class="p">,</span> <span class="s">"Drink"</span><span class="p">,</span> <span class="s">"Milk"</span><span class="p">)</span>
<span class="n">add_house_constraint</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"A"</span><span class="p">,</span> <span class="s">"Nationality"</span><span class="p">,</span> <span class="s">"Norwegian"</span><span class="p">)</span>

<span class="n">add_neighbor_constraint</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Cigar"</span><span class="p">,</span> <span class="s">"Blends"</span><span class="p">,</span> <span class="s">"Pet"</span><span class="p">,</span> <span class="s">"Cat"</span><span class="p">)</span>
<span class="n">add_neighbor_constraint</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Cigar"</span><span class="p">,</span> <span class="s">"Dunhill"</span><span class="p">,</span> <span class="s">"Pet"</span><span class="p">,</span> <span class="s">"Horse"</span><span class="p">)</span>
<span class="n">add_neighbor_constraint</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Cigar"</span><span class="p">,</span> <span class="s">"Blends"</span><span class="p">,</span> <span class="s">"Drink"</span><span class="p">,</span> <span class="s">"Water"</span><span class="p">)</span>
<span class="n">add_neighbor_constraint</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Nationality"</span><span class="p">,</span> <span class="s">"Norwegian"</span><span class="p">,</span> <span class="s">"Color"</span><span class="p">,</span> <span class="s">"Blue"</span><span class="p">)</span>

<span class="n">add_neighbor_constraint</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"Color"</span><span class="p">,</span> <span class="s">"Green"</span><span class="p">,</span> <span class="s">"Color"</span><span class="p">,</span> <span class="s">"White"</span><span class="p">,</span> <span class="n">left_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">check</span><span class="p">())</span>
<span class="k">print</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">model</span><span class="p">())</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">model</span><span class="p">()</span>
<span class="n">true_statements</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_true</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
        <span class="n">true_statements</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">name</span><span class="p">())</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">house</span> <span class="ow">in</span> <span class="n">houses</span><span class="p">:</span>
    <span class="n">result</span><span class="p">[</span><span class="n">house</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">true_statements</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_statements</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">true_statements</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">house</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>We added some <code class="language-plaintext highlighter-rouge">prints</code> to see the viability of the model and the model itself. In the end, we added some logic to parse the results. We would only like to see which values in the matrices contain a <strong>true</strong> value.</p>

<p>After running the program it shows us:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">{</span><span class="s">'A'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Dunhill'</span><span class="p">,</span> <span class="s">'Cat'</span><span class="p">,</span> <span class="s">'Yellow'</span><span class="p">,</span> <span class="s">'Water'</span><span class="p">,</span> <span class="s">'Norwegian'</span><span class="p">],</span>
<span class="s">'B'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Blue'</span><span class="p">,</span> <span class="s">'Dane'</span><span class="p">,</span> <span class="s">'Blends'</span><span class="p">,</span> <span class="s">'Tea'</span><span class="p">,</span> <span class="s">'Horse'</span><span class="p">],</span>
<span class="s">'C'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Bird'</span><span class="p">,</span> <span class="s">'Brit'</span><span class="p">,</span> <span class="s">'Red'</span><span class="p">,</span> <span class="s">'PallMall'</span><span class="p">,</span> <span class="s">'Milk'</span><span class="p">],</span>
<span class="s">'D'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Prince'</span><span class="p">,</span> <span class="s">'German'</span><span class="p">,</span> <span class="s">'Fish'</span><span class="p">,</span> <span class="s">'Green'</span><span class="p">,</span> <span class="s">'Coffee'</span><span class="p">],</span>
<span class="s">'E'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Dog'</span><span class="p">,</span> <span class="s">'Beer'</span><span class="p">,</span> <span class="s">'Swede'</span><span class="p">,</span> <span class="s">'White'</span><span class="p">,</span> <span class="s">'BlueMaster'</span><span class="p">]}</span></code></pre></figure>

<p>We could see that the German is the owner of the fish.</p>

<p>Looking at the <a href="https://udel.edu/~os/riddle-solution.html">solution</a>, we verify that our model worked correctly.</p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-12-04T14:00:00-03:00">December 4, 2021</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Solving+Einstein+riddle+with+Z3%20http%3A%2F%2Flocalhost%3A4000%2Fpython%2Fz3%2Friddle%2F2021%2F12%2F04%2Fsolving-Einstein-riddle-with-Z3.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fpython%2Fz3%2Friddle%2F2021%2F12%2F04%2Fsolving-Einstein-riddle-with-Z3.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fpython%2Fz3%2Friddle%2F2021%2F12%2F04%2Fsolving-Einstein-riddle-with-Z3.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/min-cut/graph/2021/11/23/min-cut-problem-variations.html" class="pagination--pager" title="Min-cut problem variations
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/post1header.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/min-cut/graph/2021/11/23/min-cut-problem-variations.html" rel="permalink">Min-cut problem variations
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Last week I needed to solve a variation of the min-cut problem for flow networks. For those who don’t know about the minimum cut of a flow network, I will gi...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/martinsuarezz" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 The code less travelled. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript"
     src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/MotionPathPlugin.min.js"></script>
    <script src="/assets/js/main.js"></script>
  </body>
</html>
